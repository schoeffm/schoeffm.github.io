<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Testing web-components in isolation can be a challenging task. The (current) usual suspects in this area still lack support for the standard and thus cannot be used (at least at the time of this writing). Also, the web is swamped by posts about frameworks and thus finding good example projects or tutorials is also challenging.
Finally, we found, at least for our project, a good solution which does the job and whose setup I&rsquo;d like to write down/preserve (find the corrsponding code in this repo).'>
<meta name='theme-color' content='#44ccff'>

<meta property='og:title' content='Testing Web Components • Personal PasteBin'>
<meta property='og:description' content='Testing web-components in isolation can be a challenging task. The (current) usual suspects in this area still lack support for the standard and thus cannot be used (at least at the time of this writing). Also, the web is swamped by posts about frameworks and thus finding good example projects or tutorials is also challenging.
Finally, we found, at least for our project, a good solution which does the job and whose setup I&rsquo;d like to write down/preserve (find the corrsponding code in this repo).'>
<meta property='og:url' content='https://schoeffm.github.io/posts/testing-web-components/'>
<meta property='og:site_name' content='Personal PasteBin'>
<meta property='og:type' content='article'><meta property='article:section' content='posts'><meta property='article:tag' content='web-components'><meta property='article:tag' content='testing'><meta property='article:published_time' content='2019-08-02T08:14:21&#43;02:00'/><meta property='article:modified_time' content='2019-08-02T08:14:21&#43;02:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.56.3" />

  <title>Testing Web Components • Personal PasteBin</title>
  <link rel='canonical' href='https://schoeffm.github.io/posts/testing-web-components/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.fb20af92.css'><link rel='stylesheet' href='/css/custom.css'><style>
:root{--color-accent:#44ccff;}
</style>

  

</head>
<body class='page type-posts has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/'>
        <img src='/images/logo.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
      <a href='/'>
      Personal PasteBin
      </a>
    </h2>
    <div class='desc'>
    @schoeffm
    </div>
  </header>

</section>
<section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Tags</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud no-shuffle'><li>
        <a href='/tags/base64/' style='font-size:1em'>base64</a>
      </li><li>
        <a href='/tags/cheatsheet/' style='font-size:1.25em'>cheatsheet</a>
      </li><li>
        <a href='/tags/chunk/' style='font-size:1em'>chunk</a>
      </li><li>
        <a href='/tags/ci/cd/' style='font-size:1em'>ci/cd</a>
      </li><li>
        <a href='/tags/cli/' style='font-size:1.5em'>cli</a>
      </li><li>
        <a href='/tags/configuration/' style='font-size:1em'>configuration</a>
      </li><li>
        <a href='/tags/devops/' style='font-size:2em'>devops</a>
      </li><li>
        <a href='/tags/fetch/' style='font-size:1em'>fetch</a>
      </li><li>
        <a href='/tags/jakartaee/' style='font-size:1.25em'>jakartaee</a>
      </li><li>
        <a href='/tags/jax-rs/' style='font-size:1.25em'>jax-rs</a>
      </li><li>
        <a href='/tags/jee/' style='font-size:1.25em'>jee</a>
      </li><li>
        <a href='/tags/jenkins/' style='font-size:1em'>jenkins</a>
      </li><li>
        <a href='/tags/jmeter/' style='font-size:1em'>jmeter</a>
      </li><li>
        <a href='/tags/kubernetes/' style='font-size:1em'>kubernetes</a>
      </li><li>
        <a href='/tags/linux/' style='font-size:1.25em'>linux</a>
      </li><li>
        <a href='/tags/loadtesting/' style='font-size:1em'>loadtesting</a>
      </li><li>
        <a href='/tags/microprofile/' style='font-size:1.25em'>microprofile</a>
      </li><li>
        <a href='/tags/network/' style='font-size:1em'>network</a>
      </li><li>
        <a href='/tags/openshift/' style='font-size:1em'>openshift</a>
      </li><li>
        <a href='/tags/performance/' style='font-size:1em'>performance</a>
      </li><li>
        <a href='/tags/permissions/' style='font-size:1em'>permissions</a>
      </li><li>
        <a href='/tags/pipelines/' style='font-size:1em'>pipelines</a>
      </li><li>
        <a href='/tags/rest/' style='font-size:1em'>rest</a>
      </li><li>
        <a href='/tags/ssh/' style='font-size:1em'>ssh</a>
      </li><li>
        <a href='/tags/streaming/' style='font-size:1.25em'>streaming</a>
      </li><li>
        <a href='/tags/taurus/' style='font-size:1em'>taurus</a>
      </li><li>
        <a href='/tags/tcpdump/' style='font-size:1em'>tcpdump</a>
      </li><li>
        <a href='/tags/testing/' style='font-size:1.25em'>testing</a>
      </li><li>
        <a href='/tags/tools/' style='font-size:1em'>tools</a>
      </li><li>
        <a href='/tags/users/' style='font-size:1em'>users</a>
      </li><li>
        <a href='/tags/web-components/' style='font-size:1.25em'>web-components</a>
      </li></ul>
</div>


</section>
</div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    <a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />
  
</svg>
</span>
  <span class='close'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
  
</svg>
</span>
</button>
    <ul><li class='item'>
        <a href='' class="">
          <span></span>
        </a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'>
    
    <style>.widget-breadcrumbs li:after{content:'\2f '}</style>
  <section class='widget widget-breadcrumbs sep-after'>
    <nav id='breadcrumbs'>
      <ol><li><a href='/'>Personal PasteBin</a></li><li><a href='/posts/'>Posts</a></li><li><span>Testing Web Components</span></li></ol>
    </nav>
  </section></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Personal PasteBin</p><p class='desc site-desc'></p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Testing Web Components</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2019-08-02T08:14:21&#43;02:00'>2019, Aug 02</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
6 mins read
</span>


  
  
</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>Testing web-components in isolation can be a challenging task. The (<em>current</em>) usual suspects in this area still <a href="https://github.com/jsdom/jsdom/issues/1030" target="_blank">lack support for the standard</a> and thus cannot be used (at least at the time of this writing). Also, the web is swamped by posts about frameworks and thus finding good example projects or tutorials is also challenging.<br/>
Finally, we found, at least for our project, a good solution which does the job and whose setup I&rsquo;d like to write down/preserve (find the <a href="https://github.com/schoeffm/testing-web-components" target="_blank">corrsponding code in this repo</a>).</p>

<p>So after a few flops we stumbled upon <a href="https://open-wc.org/" target="_blank">the open-wc project</a> and their <a href="https://open-wc.org/testing/" target="_blank">testing modules</a>. Since we had our project already setup we were just interested in the testing stuff - thus we tried to integrate only those dependencies (and skipped the scaffolding-, webpack-, transpiling-stuff).<br/></p>

<h2 id="setting-things-up">Setting things up</h2>

<p>Let&rsquo;s start with a blank slate where we just install the <a href="https://open-wc.org/testing/testing-karma.html#default-configuration" target="_blank">openwc-testing dependencies</a> (and their pre-requisites).</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir -p testing-wc/src/main/js <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    cd testing-wc <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    npm init -f
$ npm -i --save-dev @open-wc/testing-karma @open-wc/testing lit-html karma mocha </code></pre></div>

<p>Next, let&rsquo;s create some components we can test - a parent-component which holds a child-component. The latter represents a simple UI-component while the parent also contains a <code>fetch</code>-call and thus interacts with the backend/network. The project structure looks like that:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">.
├── karma.conf.js
├── package.json
└── src
    └── main
        ├── js
        │   ├── app.js
        │   ├── components
        │   │   ├── child.component.js
        │   │   └── parent.component.js
        │   └── index.html
        └── test
            ├── api
            │   └── customers
            └── components
                ├── child.component.test.js
                └── parent.component.test.js</code></pre></div>

<p><code>index.html</code> and <code>app.js</code> are not relvant for this post (they only glue the components together). But before we can focus on the components and their tests we should have a look at <code>karma.conf.js</code> first.</p>

<p>Since we use <a href="http://karma-runner.github.io/latest/index.html" target="_blank">karma</a> to launch and subsequently test our components we have to provide a suitable <code>karma.config.js</code> next to our <code>package.json</code>. Thanks to the <a href="https://open-wc.org/" target="_blank">open-wc project</a> we can start using <a href="https://open-wc.org/testing/testing-karma.html#manual-setup" target="_blank">their suggestion</a> and adjust it slightly to match our project-structure:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> {<span style="color:#a6e22e">createDefaultConfig</span>} <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@open-wc/testing-karma&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">merge</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;deepmerge&#39;</span>);

<span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">config</span> =&gt; {
    <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">set</span>(
            <span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">createDefaultConfig</span>(<span style="color:#a6e22e">config</span>), {
                <span style="color:#a6e22e">files</span><span style="color:#f92672">:</span> [
                    {<span style="color:#a6e22e">pattern</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./src/**/test/api/**/*&#39;</span>, <span style="color:#a6e22e">watched</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">included</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">served</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>},
                    {<span style="color:#a6e22e">pattern</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">grep</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">grep</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./src/main/test/**/*.test.js&#39;</span>, <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;module&#39;</span>}
                ],
            <span style="color:#a6e22e">esm</span><span style="color:#f92672">:</span> {
                <span style="color:#a6e22e">nodeResolve</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
            },
            <span style="color:#a6e22e">proxies</span><span style="color:#f92672">:</span> {
                <span style="color:#e6db74">&#39;/sfm/&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;/base/src/main/test/&#39;</span>
            },
        }),
    );
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">config</span>;
};
</code></pre></div>

<p>Beside referencing our test descriptions under <code>src/main/test/**</code> we also let karma <em>serve</em> files from the <code>src/**/test/api</code> (sub-)folders.<br/>
In addition to this we instruct karma to proxy requests to <code>/sfm/</code> and map &lsquo;em to the defined folder. The reason for this is explained later when we have to deal with API calls.</p>

<h2 id="let-s-write-some-tests">Let&rsquo;s write some tests</h2>

<p>After setting everything up we can finally have a look at the actual components and their tests. Let&rsquo;s start with the simple child-component first:</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChildComponent</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">HTMLElement</span> {
    <span style="color:#a6e22e">constructor</span>() {
        <span style="color:#66d9ef">super</span>();
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">attachShadow</span>({<span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;open&#39;</span>});
    }

    <span style="color:#a6e22e">set</span> <span style="color:#a6e22e">firstname</span>(<span style="color:#a6e22e">firstname</span>) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;firstname&#34;</span>, <span style="color:#a6e22e">firstname</span>); }
    <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">firstname</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;firstname&#34;</span>); }

    <span style="color:#a6e22e">set</span> <span style="color:#a6e22e">lastname</span>(<span style="color:#a6e22e">lastname</span>) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;lastname&#34;</span>, <span style="color:#a6e22e">lastname</span>); }
    <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">lastname</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;lastname&#34;</span>); }

    <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">connectedCallback</span>() {
        <span style="color:#a6e22e">customElements</span>
            .<span style="color:#a6e22e">whenDefined</span>(<span style="color:#e6db74">&#39;sfm-child&#39;</span>)
            .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">_</span> =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>());
    }

    <span style="color:#a6e22e">render</span>() {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">            &lt;div&gt;Hello </span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">firstname</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lastname</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/div&gt;
</span><span style="color:#e6db74">        `</span>;
    }
}
<span style="color:#a6e22e">customElements</span>.<span style="color:#a6e22e">define</span>(<span style="color:#e6db74">&#39;sfm-child&#39;</span>, <span style="color:#a6e22e">ChildComponent</span>);
</code></pre></div>
This, quite simple, example should get us started.<br/>
As you can see, it takes two properties and renders their content to shadow-dom. It doesn&rsquo;t define any logic which can be tested - so at least let&rsquo;s verify that it renders as expected:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">import</span> {<span style="color:#a6e22e">fixture</span>, <span style="color:#a6e22e">expect</span>} <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@open-wc/testing&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;../../js/components/child.component.js&#39;</span>;

<span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;Child-Component&#39;</span>, () =&gt; {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">underTest</span>;
    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#66d9ef">async</span> () =&gt; {
        <span style="color:#a6e22e">underTest</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fixture</span>(<span style="color:#e6db74">&#39;&lt;sfm-child firstname=&#34;Luke&#34; lastname=&#34;Skywalker&#34;&gt;&lt;/sfm-child&gt;&#39;</span>);
    });
    <span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;When initialized&#39;</span>, () =&gt; {
        <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;will render given properties&#39;</span>, <span style="color:#66d9ef">async</span> () =&gt; {
            <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">underTest</span>.<span style="color:#a6e22e">firstname</span>).<span style="color:#a6e22e">to</span>.<span style="color:#a6e22e">be</span>.<span style="color:#a6e22e">eq</span>(<span style="color:#e6db74">&#39;Luke&#39;</span>);
            <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">underTest</span>.<span style="color:#a6e22e">lastname</span>).<span style="color:#a6e22e">to</span>.<span style="color:#a6e22e">be</span>.<span style="color:#a6e22e">eq</span>(<span style="color:#e6db74">&#39;Skywalker&#39;</span>);
            <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">underTest</span>.<span style="color:#a6e22e">shadowRoot</span>.<span style="color:#a6e22e">innerHTML</span>).<span style="color:#a6e22e">to</span>.<span style="color:#a6e22e">be</span>.<span style="color:#a6e22e">eq</span>(<span style="color:#e6db74">&#39;&lt;div&gt;Hello Luke Skywalker&lt;/div&gt;&#39;</span>)
        });
    });
});
</code></pre></div>

<p>First, we import two helper-methods from <a href="https://open-wc.org/testing/" target="_blank">open-wc testing</a>. <code>fixture</code> renders our custom component (which gets imported in the next line) into the karma testpage and returns a reference to this dom element. All this is done in the <code>beforeEach</code>-block. <code>expect</code> opens the door to <a href="https://www.chaijs.com/api/" target="_blank">chai</a> (which is used under the hoods) and let us verify our expectations.<br/>
So here we just make sure that when we render our child-component with two pre-defined attribute values the component:</p>

<ul>
<li>sets the given attribues also as properties of the component</li>
<li>outputs/renders HTML into shadow dom as expected</li>
</ul>

<p>Although it is dead simple this test should get you started. Since you got a reference to the component you can interact with its JS-API to change its state and verify that change using <code>expect</code>.</p>

<h2 id="test-with-network-dependency">Test with network dependency</h2>

<p>To make things a little bit more complicated let&rsquo;s add an API roundtrip to the game. The <code>ParentComponent</code> embeds the <code>ChildComponent</code> and updates its properties with data <code>fetch</code>ed from the backend.<br/>
In order to simulate that we&rsquo;ve setup karma to proxy all requests to <code>/sfm/*</code> and map those requests to static API-fixtures. So for example a request to <code>/sfm/api/customers</code> will be mapped to <code>./src/main/test/api/customers</code>. Let&rsquo;s create that file quickly so that karma can actually server content from there:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir -p ./src/main/test/api/customers <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    echo -n <span style="color:#e6db74">&#39;{&#34;id&#34;:4711,&#34;firstname&#34;:&#34;johann&#34;,&#34;lastname&#34;:&#34;doe&#34;}&#39;</span> &gt; ./src/main/test/api/customers </code></pre></div>

<p>Next, let&rsquo;s write the actual component:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">ChildComponent</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./child.component.js&#39;</span>;

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ParentComponent</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">HTMLElement</span> {

    <span style="color:#a6e22e">constructor</span>() {
        <span style="color:#66d9ef">super</span>();
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">attachShadow</span>({<span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;open&#39;</span>});
    }

    <span style="color:#a6e22e">connectedCallback</span>() {
        <span style="color:#a6e22e">customElements</span>
            .<span style="color:#a6e22e">whenDefined</span>(<span style="color:#e6db74">&#39;sfm-parent&#39;</span>)
            .<span style="color:#a6e22e">then</span>(() =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">render</span>())
            .<span style="color:#a6e22e">then</span>(() =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;sfm-child&#39;</span>))
            .<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">node</span>) =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_loadData</span>(<span style="color:#a6e22e">node</span>));
    }

    <span style="color:#a6e22e">render</span>() {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`&lt;sfm-child&gt;&lt;/sfm-child&gt;`</span>;
    }

    <span style="color:#a6e22e">_loadData</span>(<span style="color:#a6e22e">node</span>) {
        <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/sfm/api/customers&#39;</span>)
            .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>())
            .<span style="color:#a6e22e">then</span>(({<span style="color:#a6e22e">firstname</span>, <span style="color:#a6e22e">lastname</span>}) =&gt; {
                <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">firstname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">firstname</span>;
                <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">lastname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">lastname</span>;
            });
    }
}
<span style="color:#a6e22e">customElements</span>.<span style="color:#a6e22e">define</span>(<span style="color:#e6db74">&#39;sfm-parent&#39;</span>, <span style="color:#a6e22e">ParentComponent</span>);
</code></pre></div>

<p>The component renders the <code>ChildComponent</code> <em>without any attributes</em>. As soon as it gets connected it&rsquo;ll load data from <code>/sfm/api/customers</code> in order to set the result as props to the embedded <code>ChildComponent</code>. Let&rsquo;s see how to deal with that in our test:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">fixture</span>, <span style="color:#a6e22e">expect</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@open-wc/testing&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">aTimeout</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@open-wc/testing-helpers&#39;</span>;

<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;../../js/components/parent.component.js&#39;</span>;

<span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;Parent-Component&#39;</span>, () =&gt; {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">underTest</span>;
    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#66d9ef">async</span> () =&gt; {
        <span style="color:#a6e22e">underTest</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fixture</span>(<span style="color:#e6db74">&#39;&lt;sfm-parent&gt;&lt;/sfm-parent&gt;&#39;</span>);
    });

    <span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;When initialized&#39;</span>, () =&gt; {
        <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;will render, fetch data and update child-component&#39;</span>, <span style="color:#66d9ef">async</span> () =&gt; {
            <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">aTimeout</span>(<span style="color:#ae81ff">100</span>); <span style="color:#75715e">// wait for the network call
</span><span style="color:#75715e"></span>
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">child</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">underTest</span>.<span style="color:#a6e22e">shadowRoot</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;sfm-child&#39;</span>);
            <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">child</span>.<span style="color:#a6e22e">firstname</span>).<span style="color:#a6e22e">to</span>.<span style="color:#a6e22e">be</span>.<span style="color:#a6e22e">eq</span>(<span style="color:#e6db74">&#39;johann&#39;</span>);
            <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">child</span>.<span style="color:#a6e22e">lastname</span>).<span style="color:#a6e22e">to</span>.<span style="color:#a6e22e">be</span>.<span style="color:#a6e22e">eq</span>(<span style="color:#e6db74">&#39;doe&#39;</span>);
        });
    });
});
</code></pre></div>

<p>As before, using the <code>fixture</code>-method from <a href="https://open-wc.org/testing/" target="_blank">openwc</a> we render our <code>ParentComponent</code> - when that happens the component issues the network call and in order to wait for the result to arrive we have to make use of the <code>aTimeout</code> helper method. Since this has nothing to do with rendering- or the component-lifecycle itself there is no elegant way to wait for the network roundtrip as to just pause a couple of milliseconds.<br/>
After that we can check the props of the embedded component if they received our remote data and thus if the plumbing done by <code>ParentComponent</code> worked.</p>

<p>As always, you can find the complete code in <a href="https://github.com/schoeffm/testing-web-components" target="_blank">this repository</a>.</p>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/web-components/'>web-components</a>, <a class='tag' href='/tags/testing/'>testing</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/posts/tcpdump-common-commands/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Tcpdump Common Commands</a>
    </div><div class='next-entry sep-before'>
      <a href='/posts/linux-permission-management/'>
        <span class='screen-reader-text'>Next post: </span>Linux Permission Management<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2019 schoeffm </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src ="/assets/js/"</script>

<script src='https://schoeffm.github.io/assets/js/main.9e5c4cf4.js'></script><script src='/js/custom.js'></script>
</body>

</html>






















