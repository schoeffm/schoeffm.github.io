<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='When dealing with JAX-RS resources are normally assembled completely in memory before being put onto the wire for transmission. If the resulting response fits into one single chunk the transmission is accomplished in one go - if the content is bigger than 16kB it will be split into several chunks of that size. You can see the difference in the response headers where a one-go-transmission contains the Content-Length-header (where the server announces the size of the content to be transmitted) while a chunked transmission lacks the Content-Length header but contains a Transfer-Encoding: chunked header.'>
<meta name='theme-color' content='#44ccff'>

<meta property='og:title' content='Response streaming between JAX-RS and Web-Components (Part 1) • Personal PasteBin'>
<meta property='og:description' content='When dealing with JAX-RS resources are normally assembled completely in memory before being put onto the wire for transmission. If the resulting response fits into one single chunk the transmission is accomplished in one go - if the content is bigger than 16kB it will be split into several chunks of that size. You can see the difference in the response headers where a one-go-transmission contains the Content-Length-header (where the server announces the size of the content to be transmitted) while a chunked transmission lacks the Content-Length header but contains a Transfer-Encoding: chunked header.'>
<meta property='og:url' content='https://schoeffm.github.io/posts/response-streaming-between-jaxrs-and-webcomponents-part1/'>
<meta property='og:site_name' content='Personal PasteBin'>
<meta property='og:type' content='article'><meta property='article:section' content='posts'><meta property='article:tag' content='jax-rs'><meta property='article:tag' content='jee'><meta property='article:tag' content='jakartaee'><meta property='article:tag' content='microprofile'><meta property='article:tag' content='streaming'><meta property='article:published_time' content='2019-07-25T00:00:00&#43;02:00'/><meta property='article:modified_time' content='2019-07-27T11:18:59&#43;02:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.59.1" />

  <title>Response streaming between JAX-RS and Web-Components (Part 1) • Personal PasteBin</title>
  <link rel='canonical' href='https://schoeffm.github.io/posts/response-streaming-between-jaxrs-and-webcomponents-part1/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.fb20af92.css'><link rel='stylesheet' href='/css/custom.css'><style>
:root{--color-accent:#44ccff;}
</style>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-148436067-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-148436067-1');
</script>


  

</head>
<body class='page type-posts has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/'>
        <img src='/images/logo.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
      <a href='/'>
      Personal PasteBin
      </a>
    </h2>
    <div class='desc'>
    @schoeffm
    </div>
  </header>

</section>
<section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Tags</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud no-shuffle'><li>
        <a href='/tags/api/' style='font-size:1em'>api</a>
      </li><li>
        <a href='/tags/authentication/' style='font-size:1em'>authentication</a>
      </li><li>
        <a href='/tags/base64/' style='font-size:1em'>base64</a>
      </li><li>
        <a href='/tags/cheatsheet/' style='font-size:1.2em'>cheatsheet</a>
      </li><li>
        <a href='/tags/chunk/' style='font-size:1em'>chunk</a>
      </li><li>
        <a href='/tags/ci/cd/' style='font-size:1em'>ci/cd</a>
      </li><li>
        <a href='/tags/cli/' style='font-size:1.6em'>cli</a>
      </li><li>
        <a href='/tags/configuration/' style='font-size:1em'>configuration</a>
      </li><li>
        <a href='/tags/cors/' style='font-size:1em'>cors</a>
      </li><li>
        <a href='/tags/dev/' style='font-size:1em'>dev</a>
      </li><li>
        <a href='/tags/devops/' style='font-size:2em'>devops</a>
      </li><li>
        <a href='/tags/docker/' style='font-size:1em'>docker</a>
      </li><li>
        <a href='/tags/docker4mac/' style='font-size:1em'>docker4mac</a>
      </li><li>
        <a href='/tags/fetch/' style='font-size:1.2em'>fetch</a>
      </li><li>
        <a href='/tags/jakartaee/' style='font-size:1.2em'>jakartaee</a>
      </li><li>
        <a href='/tags/java/' style='font-size:1em'>java</a>
      </li><li>
        <a href='/tags/jax-rs/' style='font-size:1.2em'>jax-rs</a>
      </li><li>
        <a href='/tags/jee/' style='font-size:1.2em'>jee</a>
      </li><li>
        <a href='/tags/jenkins/' style='font-size:1em'>jenkins</a>
      </li><li>
        <a href='/tags/jmeter/' style='font-size:1em'>jmeter</a>
      </li><li>
        <a href='/tags/kubernetes/' style='font-size:1em'>kubernetes</a>
      </li><li>
        <a href='/tags/linux/' style='font-size:1.2em'>linux</a>
      </li><li>
        <a href='/tags/loadtesting/' style='font-size:1em'>loadtesting</a>
      </li><li>
        <a href='/tags/microprofile/' style='font-size:1.2em'>microprofile</a>
      </li><li>
        <a href='/tags/mitmproxy/' style='font-size:1em'>mitmproxy</a>
      </li><li>
        <a href='/tags/network/' style='font-size:1.2em'>network</a>
      </li><li>
        <a href='/tags/ntlm/' style='font-size:1em'>ntlm</a>
      </li><li>
        <a href='/tags/openshift/' style='font-size:1em'>openshift</a>
      </li><li>
        <a href='/tags/performance/' style='font-size:1em'>performance</a>
      </li><li>
        <a href='/tags/permissions/' style='font-size:1em'>permissions</a>
      </li><li>
        <a href='/tags/pipelines/' style='font-size:1em'>pipelines</a>
      </li><li>
        <a href='/tags/proxy/' style='font-size:1em'>proxy</a>
      </li><li>
        <a href='/tags/rest/' style='font-size:1em'>rest</a>
      </li><li>
        <a href='/tags/security/' style='font-size:1em'>security</a>
      </li><li>
        <a href='/tags/ssh/' style='font-size:1em'>ssh</a>
      </li><li>
        <a href='/tags/streaming/' style='font-size:1.2em'>streaming</a>
      </li><li>
        <a href='/tags/taurus/' style='font-size:1em'>taurus</a>
      </li><li>
        <a href='/tags/tcpdump/' style='font-size:1em'>tcpdump</a>
      </li><li>
        <a href='/tags/testing/' style='font-size:1.2em'>testing</a>
      </li><li>
        <a href='/tags/tools/' style='font-size:1.2em'>tools</a>
      </li><li>
        <a href='/tags/users/' style='font-size:1em'>users</a>
      </li><li>
        <a href='/tags/web-components/' style='font-size:1.4em'>web-components</a>
      </li></ul>
</div>


</section>
</div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    <a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />
  
</svg>
</span>
  <span class='close'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
  
</svg>
</span>
</button>
    <ul><li class='item'>
        <a href='' class="">
          <span></span>
        </a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'>
    
    <style>.widget-breadcrumbs li:after{content:'\2f '}</style>
  <section class='widget widget-breadcrumbs sep-after'>
    <nav id='breadcrumbs'>
      <ol><li><a href='/'>Personal PasteBin</a></li><li><a href='/posts/'>Posts</a></li><li><span>Response streaming between JAX-RS and Web-Components (Part 1)</span></li></ol>
    </nav>
  </section></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Personal PasteBin</p><p class='desc site-desc'></p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Response streaming between JAX-RS and Web-Components (Part 1)</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2019-07-27T11:18:59&#43;02:00'>2019, Jul 27</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
3 mins read
</span>


  
  
</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>When dealing with JAX-RS resources are normally assembled completely in memory before being put onto the wire for transmission. If the resulting response fits into one single chunk the transmission is accomplished in one go - if the content is bigger than 16kB it will be split into several chunks of that size. You can see the difference in the response headers where a one-go-transmission contains the <code>Content-Length</code>-header (where the server announces the size of the content to be transmitted) while a chunked transmission lacks the <code>Content-Length</code> header but contains a <code>Transfer-Encoding: chunked</code> header.</p>

<p>The crux with this approach is that you&rsquo;ll always have to <strong>load all the data comprising the response before a single bit is transfered to the client</strong>. That buffering can become a performance issue when dealing with large amounts of data or when loading of that data is sluggish.</p>

<p>To ship chunks as soon as they&rsquo;re filled and before even knowing the final bit of the response you can make use of JAX-RS&rsquo; <code>StreamingOutput</code> interface. Put an implementation of that interface as the entity in a <code>Response</code> and JAX-RS will send each chunk as soon as it is filled. <br/>
Here&rsquo;s an example (simulating a large resource which also takes long to load):</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@GET</span>
<span style="color:#a6e22e">@Path</span>(<span style="color:#e6db74">&#34;stream&#34;</span>)
<span style="color:#a6e22e">@Produces</span>(MediaType.<span style="color:#a6e22e">TEXT_PLAIN</span>)
<span style="color:#960050;background-color:#1e0010">public Response </span>streamMe() {
    <span style="color:#960050;background-color:#1e0010">StreamingOutput stream </span><span style="color:#f92672">=</span> output <span style="color:#f92672">-&gt;</span> {
        <span style="color:#960050;background-color:#1e0010">Writer writer </span><span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedWriter(<span style="color:#66d9ef">new</span> OutputStreamWriter(output));
        <span style="color:#66d9ef">for</span> (<span style="color:#960050;background-color:#1e0010">int i </span><span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> 1000; i<span style="color:#f92672">++</span>) {
            writer.<span style="color:#a6e22e">write</span>(Json.<span style="color:#a6e22e">createObjectBuilder</span>()
                    .<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;index&#34;</span>, i)
                    .<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;content&#34;</span>, <span style="color:#e6db74">&#34;Some random text which actually can be generated in order to be really random&#34;</span>)
                    .<span style="color:#a6e22e">build</span>().<span style="color:#a6e22e">toString</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>);
            pause(10L); <span style="color:#75715e">// pause Thread for 10ms
</span><span style="color:#75715e"></span>        }
        writer.<span style="color:#a6e22e">flush</span>();
    };

    <span style="color:#66d9ef">return</span> Response.<span style="color:#a6e22e">ok</span>(stream).<span style="color:#a6e22e">build</span>();
}</code></pre></div>

<p>The <code>StreamingOutput</code>-implementation is set as the <code>Response</code> entity. Notice, that the returned content is announced as <code>text/plain</code> since it&rsquo;s just a <em>newline</em> separated list of ASCII text (in part 2 when looking at a client implementation we&rsquo;ll see why this is necessary).</p>

<p>When hitting this endpoint in the browser it&rsquo;ll show the followin&rsquo; waterfall diagram:</p>

<figure>
    <img src="/posts/streaming/waterfall_when_response_is_streamed.png"
         alt="Streamed Response"/> 
</figure>


<p>Comparing this result to the behavior of a normal JAX-RS endpoint which doesn&rsquo;t use <code>StreamingOutput</code></p>

<figure>
    <img src="/posts/streaming/waterfall_when_response_is_not_streamed.png"
         alt="Normal Response"/> 
</figure>


<p>you can see that the overall load-time didn&rsquo;t change. <strong>But the <em>time-to-first-byte (TTFB)</em> was significantly reduced.</strong> In the streaming-version of the endpoint the client could start parsing/rendering the (first part of the) output after 2.75 seconds while without streaming it has to wait the full 11.40 seconds.</p>

<p>In both these examples the transmission was chunked - but only the first one leveraged the chunks to provide a better <a href="https://www.keycdn.com/blog/perceived-performance" target="_blank">perceived performance</a>.</p>

<p>In the <a href="/posts/response-streaming-between-jaxrs-and-webcomponents-part2/" target="_blank">2nd part</a> of this post I&rsquo;ll show a (simple) web-component which uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank">fetch-API</a> to load the streamed content - the complete code for these examples can be found in <a href="https://github.com/schoeffm/jax-rs-streamingoutput" target="_blank">this repository</a>.</p>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/jax-rs/'>jax-rs</a>, <a class='tag' href='/tags/jee/'>jee</a>, <a class='tag' href='/tags/jakartaee/'>jakartaee</a>, <a class='tag' href='/tags/microprofile/'>microprofile</a>, <a class='tag' href='/tags/streaming/'>streaming</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/posts/easy-en-decoding-using-base64/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Easy en-/decoding using base64</a>
    </div><div class='next-entry sep-before'>
      <a href='/posts/response-streaming-between-jaxrs-and-webcomponents-part2/'>
        <span class='screen-reader-text'>Next post: </span>Response streaming between JAX-RS and Web-Components (Part 2)<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2019-2020 schoeffm </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src ="/assets/js/"</script>

<script src='https://schoeffm.github.io/assets/js/main.9e5c4cf4.js'></script><script src='/js/custom.js'></script>
</body>

</html>






















