<!doctype html><html lang=en class=direction-ltr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Troubleshooting Containerized Java Applications via JMX - Personal PasteBin</title><meta name=keywords content="java,jmx,flightrecorder,missioncontrol,zmc,visualvm,docker,payara,performance,analysis"><meta name=description content="When developing JEE applications these days we not only deploy &lsquo;em as containerized apps but (at least in my teams) also use containers for local development.
One issue I was confronted with the other day was a performance bug with one of our apps. Back in the days I&rsquo;d have just fired up VisualVM to connect to the local process causing trouble - but now, the process to attach to doesn&rsquo;t run locally anymore."><meta name=author content="schoeffm"><link rel=canonical href=https://schoeffm.github.io/posts/troubleshooting-containerized-java-applications/><link href=https://schoeffm.github.io/assets/css/stylesheet.min.a7be9e3b28868ad9d1331f00b5e9c207efbfe37aea15c32d101d76f2901bb918.css integrity="sha256-p76eOyiGitnRMx8AtenCB++/43rqFcMtEB128pAbuRg=" rel="preload stylesheet" as=style><link rel=apple-touch-icon href=https://schoeffm.github.io/apple-touch-icon.png><link rel=icon href=https://schoeffm.github.io/favicon.ico><meta name=generator content="Hugo 0.76.5"><meta property="og:title" content="Troubleshooting Containerized Java Applications via JMX"><meta property="og:description" content="When developing JEE applications these days we not only deploy &lsquo;em as containerized apps but (at least in my teams) also use containers for local development.
One issue I was confronted with the other day was a performance bug with one of our apps. Back in the days I&rsquo;d have just fired up VisualVM to connect to the local process causing trouble - but now, the process to attach to doesn&rsquo;t run locally anymore."><meta property="og:type" content="article"><meta property="og:url" content="https://schoeffm.github.io/posts/troubleshooting-containerized-java-applications/"><meta property="article:published_time" content="2020-05-02T13:18:06+02:00"><meta property="article:modified_time" content="2020-05-02T13:18:06+02:00"><meta property="og:site_name" content="Personal PasteBin"><meta name=twitter:card content="summary"><meta name=twitter:title content="Troubleshooting Containerized Java Applications via JMX"><meta name=twitter:description content="When developing JEE applications these days we not only deploy &lsquo;em as containerized apps but (at least in my teams) also use containers for local development.
One issue I was confronted with the other day was a performance bug with one of our apps. Back in the days I&rsquo;d have just fired up VisualVM to connect to the local process causing trouble - but now, the process to attach to doesn&rsquo;t run locally anymore."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Troubleshooting Containerized Java Applications via JMX","name":"Troubleshooting Containerized Java Applications via JMX","description":"When developing JEE applications these days we not only deploy \u0026amp;lsquo;em as containerized apps but (at least in my teams) also use containers for local development.\nOne issue I was …","keywords":["java","jmx","flightrecorder","missioncontrol","zmc","visualvm","docker","payara","performance","analysis"],"articleBody":"When developing JEE applications these days we not only deploy ‘em as containerized apps but (at least in my teams) also use containers for local development.\nOne issue I was confronted with the other day was a performance bug with one of our apps. Back in the days I’d have just fired up VisualVM to connect to the local process causing trouble - but now, the process to attach to doesn’t run locally anymore.\nJMX pre-requisite At the end of the day the solution is pretty simple - just treat the containerized process as an external app (i.e. like an app that was deployed on a remote server) and connect to it via JMX. Unfortunately, this can become quite tricky.\n  Turn on JMX -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 This activates JMX and binds the JMX-server to port 9090 (why you need to repeat the ports)\n  Turn off authentication and transport-layer security -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false  You should think twice before you turn off those security features. It’s way easier to set things up this way at the expense of security of course. IMHO for my use-cases the threat is negligible:\n use JMX locally for debugging purposes use it within a kubernetes setup where I forward that port to my local machine and don’t expose the JMX server to others (more on that later).  Anyways, you have to make that decision yourself in the context of your project.\n  Setting up the IP/Host: This is the tricky part and has sth. to do with JMX on linux (which your container is most probably running). When you execute hostname -i within your container it’ll resolve to an IP-address not know to/resolvable by the outside world.I found two solutions to this issue:\n setting the JMX-host explicitly -Djava.rmi.server.hostname= CONTAINER_IP has to be the external IP-address assigned to the container. So for your local docker environment this would be the hosts address (sth. like 192.168.178.33).This approach though is less portable since all of your collegues will have to change that address to match their enviornment. setting the hostname via docker docker run --rm -ti --hostname localhost payara/server-full When starting your container (either via docker-compose or plain docker) you can pass in the hostname the container should have. If you turn that to localhost the container will resolve its hostname to: payara@localhost:~$ hostname -i 127.0.0.1 172.26.0.4 ::1    Lets take all this toghether and start a payara/server-full container with active JMX:\ndocker run --rm -ti \\  -e JVM_ARGS=\"-Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false\" \\  --hostname localhost \\  -p 9090:9090 -p 8080:8080 \\  payara/server-full or you set the JMX-host explicitly (assuming your machines IP is 192.168.178.22): docker run --rm -ti \\  -e JVM_ARGS=\"-Djava.rmi.server.hostname=192.168.178.22 -Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false\" \\  -p 9090:9090 -p 8080:8080 \\  payara/server-full\nIn both cases you’d be able to connect to your containerized app via:   Connecting to pods running on k8s or openshift So far we just looked at how to connect to a container running in your local docker-host. But when dealing with JMX (and the capabilities waiting beyond, like FlightRecorder and MissionControl) it’s maybe even more interesting to connect to productive applications running in a kubernetes-ish orchestrator (nothing else seems to be relevant anyways).\nAssuming you’ve setup the container within the pod to start a JMX-server that binds to 127.0.0.1:9090 (using the means from above) you could forward that port to your local machine with: kubectl port-forward  9090:9090\nSubsequently, you’re again able to connect to localhost:9090 using JConsole or VisualVM exploring information about the remote container.\nLeverage tools now JConsole To test the setup just start your container, add a port-mapping for the JMX-port docker run --rm -ti \\  -e JVM_ARGS=\"-Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false\" \\  --hostname localhost \\  -p 9090:9090 -p 8080:8080 \\  payara/server-full\nand use i.e. /bin/jconsole (which is most probably still part of your JDK-installation) to connect to the respective JMX-socket on localhost:9090 (confirm any security warnings).\n  VisualVM jconsole is nice, but the aforementioned VisualVM is able to give us deeper insights.\nUnless you’re using GraalVM, your JDK either doesn’t contain VisualVM anymore or it contains an ancient version. It was shipped as part of Oracle JDK until version 8 but was discontinued and is distributed now as independent tool. Since I use sdkman to manage parallel JDK-installations I incidentally already had a GraalVM installation which included VisualVM.\nIf that is not the case you can download VisualVM as a separate tool or check your package manager (like brew cask install visualvm).\n VisualVM of GraalVM: here it was enough to just start the app from within the bin-directory: /bin/jvisualvm dedicated VisualVM: since I still had an ancient Mac-Installation of JDK I explicitly had to point it to the correct JDK: /Applications/VisualVM.app/Contents/MacOS/visualvm --jdkhome ~/.sdkman/candidates/java/14.0.1-zulu  Via Add JMX Connection you can then connect using localhost:9090 to your containerized app again:\n  In contrast to JConsole, VisualVM offers a CPU- and Memory-Sampling Profiler which is very useful to identify bottlenecks and general performance hotspots.\nUsing MissionControl and FlightRecorder Although using VisualVM most of the time is enough to pinpoint (simple) performance issues I was curious about the integration with MissionControl and FlightRecorder.\n Java Flight Recorder is a profiling and event collection framework […] Mission Control is an advanced set of tools that enables efficient and detailed analysis of the extensive data collected by Java Flight Recorder.\n The tools are conceived to impose as little overhead to a running application as possible and thus can even be used in production environments - well, and were a commercial feature hence.\nThings have changed though and starting from Oracle JDK 11 on FlightRecorder was (along with the actual JDK) open-sourced. Additionally, the guys from Azul backported that feature also to their JDK 8 offering (even for the community build).\n … you can use Zulu Mission Control on Zulu Enterprise, Zing, and Zulu Community builds of OpenJDK …\n Since in our examples we used payara/server-full which is based on azul/zulu-openjdk we’re able to leverage that tools. So, let’s download and unpack ZMC (Zulu Mission Control).\nJust like VisualVM also ZMC had an issue with may ancient Mac-Java - so I had to explicitly point it to a JDK to be used. For that, find the zmc.ini-file (for Mac this is /Contents/Eclipse/zmc.ini) and add the -vm option:\n-vm /Users/schoeffm/.sdkman/candidates/java/14.0.1-zulu/bin After that, start the tool, connect it via JMX to the running, containerized process and have look around\n  For Zulu-JDK you don’t even have to set -XX:+FlightRecorder anymore to activate the feature since it’s activated by default already. But when working with an application server there are still some JVM-options worth changing/setting to get better results.\n-XX:FlightRecorderOptions=stackdepth=2048 -XX:+UnlockDiagnosticVMOptions -XX:+DebugNonSafepoints FlightRecorderOptions increases the stackdepth that gets recorded (otherwise stack traces would be truncated) and DebugNonSafepoints (which has to be combined with UnlockDiagnosticVMOptions) improves fidelity as explained here.\nYou could even start a continous recording that will be started along with the process and that stores its information in a ring-buffer waiting happily for being dumped and analyzed on demand by adding:\n-XX:StartFlightRecording=disk=true,name=core,dumponexit=true,maxage=3h,settings=profile  To get more information about ZMC and its background have a look at this webinar recording.\nHappy troubleshooting!\n","wordCount":"1171","inLanguage":"en","datePublished":"2020-05-02T13:18:06+02:00","dateModified":"2020-05-02T13:18:06+02:00","author":{"@type":"Person","name":"schoeffm"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://schoeffm.github.io/posts/troubleshooting-containerized-java-applications/"},"publisher":{"@type":"Organization","name":"Personal PasteBin","logo":{"@type":"ImageObject","url":"https://schoeffm.github.io/favicon.ico"}}}</script></head><body class=single id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else{if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><p class=logo><a href=https://schoeffm.github.io/><img src=/apple-touch-icon.png alt=logo aria-label=logo height=35>Home</a>
<span class=theme-toggle><a id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></p><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://schoeffm.github.io/archives/><span>Archives</span></a></li><li><a href=https://schoeffm.github.io/tags/><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Troubleshooting Containerized Java Applications via JMX</h1><div class=post-meta>May 2, 2020&nbsp;·&nbsp;6 min&nbsp;·&nbsp;schoeffm</div></header><div class=post-content><p>When developing JEE applications these days we not only deploy &lsquo;em as containerized apps but (at least in my teams) also use containers for local development.</p><p>One issue I was confronted with the other day was a performance bug with one of our apps. Back in the days I&rsquo;d have just fired up <a href=https://visualvm.github.io/>VisualVM</a> to connect to the local process causing trouble - but now, the process to attach to doesn&rsquo;t run locally anymore.</p><h2 id=jmx-pre-requisite>JMX pre-requisite</h2><p>At the end of the day the solution is pretty simple - just treat the containerized process as an external app (i.e. like an app that was deployed on a remote server) and connect to it via JMX. Unfortunately, this can become quite tricky.</p><ol><li><p><strong>Turn on JMX</strong><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-Dcom.sun.management.jmxremote 
-Dcom.sun.management.jmxremote.port<span style=color:#f92672>=</span><span style=color:#ae81ff>9090</span>
-Dcom.sun.management.jmxremote.rmi.port<span style=color:#f92672>=</span><span style=color:#ae81ff>9090</span></code></pre></div>This activates JMX and binds the JMX-server to port 9090 (<a href=https://stackoverflow.com/questions/20884353/why-java-opens-3-ports-when-jmx-is-configured#answer-21552812>why you need to repeat the ports</a>)</p></li><li><p><strong>Turn off authentication and transport-layer security</strong><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-Dcom.sun.management.jmxremote.ssl<span style=color:#f92672>=</span>false 
-Dcom.sun.management.jmxremote.authenticate<span style=color:#f92672>=</span>false </code></pre></div>You should think twice before you turn off those security features. It&rsquo;s way easier to set things up this way at the expense of security of course. IMHO for my use-cases the threat is negligible:</p><ul><li>use JMX locally for debugging purposes</li><li>use it within a kubernetes setup where I forward that port to my local machine and don&rsquo;t expose the JMX server to others (more on that later).</li></ul><p>Anyways, you have to make that decision yourself in the context of your project.</p></li><li><p><strong>Setting up the IP/Host</strong>: This is the tricky part and has <a href=https://docs.oracle.com/javase/8/docs/technotes/guides/management/faq.html#linux1>sth. to do with JMX on linux</a> (which your container is most probably running). When you execute <code>hostname -i</code> within your container it&rsquo;ll resolve to an IP-address not know to/resolvable by the outside world. I found two solutions to this issue:</p><ol><li>setting the JMX-host explicitly<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-Djava.rmi.server.hostname<span style=color:#f92672>=</span>&lt;CONTAINER_IP&gt;</code></pre></div><code>CONTAINER_IP</code> has to be the external IP-address assigned to the container. So for your local docker environment this would be the hosts address (sth. like <code>192.168.178.33</code>). This approach though is less portable since all of your collegues will have to change that address to match their enviornment.</li><li>setting the hostname via <code>docker</code><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run --rm -ti --hostname localhost payara/server-full</code></pre></div>When starting your container (either via <code>docker-compose</code> or plain <code>docker</code>) you can pass in the hostname the container should have. If you turn that to <code>localhost</code> the container will resolve its hostname to:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>payara@localhost:~$ hostname -i
127.0.0.1 172.26.0.4 ::1</code></pre></div></li></ol></li></ol><p>Lets take all this toghether and start a <code>payara/server-full</code> container with active JMX:</p><p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run --rm -ti <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -e JVM_ARGS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --hostname localhost <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p 9090:9090 -p 8080:8080 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    payara/server-full</code></pre></div>or you set the JMX-host explicitly (assuming your machines IP is <code>192.168.178.22</code>):<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run --rm -ti <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -e JVM_ARGS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-Djava.rmi.server.hostname=192.168.178.22 -Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p 9090:9090 -p 8080:8080 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    payara/server-full</code></pre></div></p><p>In both cases you&rsquo;d be able to connect to your containerized app via:<figure><img src=/posts/troubleshooting-containerized-java-applications/jconsole.png alt=jconsole width=60%></figure></p><h3 id=connecting-to-pods-running-on-k8s-or-openshift>Connecting to pods running on k8s or openshift</h3><p>So far we just looked at how to connect to a container running in your local docker-host. But when dealing with JMX (and the capabilities waiting beyond, like FlightRecorder and MissionControl) it&rsquo;s maybe even more interesting to connect to productive applications running in a kubernetes-ish orchestrator (nothing else seems to be relevant anyways).</p><p>Assuming you&rsquo;ve setup the container within the pod to start a JMX-server that binds to <code>127.0.0.1:9090</code> (using the means from above) you could forward that port to your local machine with:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl port-forward &lt;POD-NAME&gt; 9090:9090</code></pre></div></p><p>Subsequently, you&rsquo;re again able to connect to <code>localhost:9090</code> using JConsole or VisualVM exploring information about the remote container.</p><h2 id=leverage-tools-now>Leverage tools now</h2><h3 id=jconsole>JConsole</h3><p>To test the setup just start your container, add a port-mapping for the JMX-port<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run --rm -ti <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -e JVM_ARGS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.rmi.port=9090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --hostname localhost <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p 9090:9090 -p 8080:8080 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    payara/server-full</code></pre></div></p><p>and use i.e. <code>&lt;JDK>/bin/jconsole</code> (which is most probably still part of your JDK-installation) to connect to the respective JMX-socket on <code>localhost:9090</code> (<em>confirm any security warnings</em>).</p><figure><img src=/posts/troubleshooting-containerized-java-applications/jconsole.png alt=jconsole width=60%></figure><h3 id=visualvm>VisualVM</h3><p><code>jconsole</code> is nice, but the aforementioned <a href=https://visualvm.github.io/>VisualVM</a> is able to give us deeper insights.</p><p>Unless you&rsquo;re using <a href=https://www.graalvm.org/>GraalVM</a>, your JDK either doesn&rsquo;t contain VisualVM anymore or it contains an ancient version. It was shipped as <a href=https://visualvm.github.io/javavisualvm.html>part of Oracle JDK until version 8</a> but was discontinued and is <a href=https://visualvm.github.io/>distributed now as independent tool</a>. Since I use <a href=https://sdkman.io/>sdkman</a> to manage parallel JDK-installations I incidentally already had a GraalVM installation which included VisualVM.</p><p>If that is not the case you can <a href=https://visualvm.github.io/>download VisualVM</a> as a separate tool or check your package manager (like <code>brew cask install visualvm</code>).</p><ul><li><strong>VisualVM of GraalVM</strong>: here it was enough to just start the app from within the <code>bin</code>-directory: <code>&lt;GRAAL_HOME>/bin/jvisualvm</code></li><li><strong>dedicated VisualVM</strong>: since I still had an ancient Mac-Installation of JDK I explicitly had to point it to the correct JDK: <code>/Applications/VisualVM.app/Contents/MacOS/visualvm --jdkhome ~/.sdkman/candidates/java/14.0.1-zulu</code></li></ul><p>Via <em>Add JMX Connection</em> you can then connect using <code>localhost:9090</code> to your containerized app again:</p><figure><img src=/posts/troubleshooting-containerized-java-applications/visualvm.png alt=VisualVM width=100%></figure><p>In contrast to JConsole, VisualVM offers a CPU- and Memory-Sampling Profiler which is very useful to identify bottlenecks and general performance hotspots.</p><h3 id=using-missioncontrol-and-flightrecorder>Using MissionControl and FlightRecorder</h3><p>Although using <a href=https://visualvm.github.io/>VisualVM</a> most of the time is enough to pinpoint (simple) performance issues I was curious about the integration with <a href=https://www.oracle.com/technetwork/java/javaseproducts/mission-control/index.html>MissionControl and FlightRecorder</a>.</p><blockquote><p>Java Flight Recorder is a profiling and event collection framework [&mldr;] Mission Control is an advanced set of tools
that enables efficient and detailed analysis of the extensive data collected by Java Flight Recorder.</p></blockquote><p>The tools are conceived to impose as little overhead to a running application as possible and thus can even be used in production environments - well, and were a <a href=https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/about.htm#JFRRT107>commercial feature hence</a>.</p><p>Things have changed though and starting <a href=https://wiki.openjdk.java.net/display/jmc/JMC+FAQ>from Oracle JDK 11 on</a> FlightRecorder was (along with the actual JDK) open-sourced. Additionally, the guys from <a href=https://www.azul.com/>Azul</a> backported that feature also to their <a href=https://www.azul.com/products/zulu-mission-control/>JDK 8 offering</a> (even for the community build).</p><blockquote><p>&mldr; you can use Zulu Mission Control on Zulu Enterprise, Zing, and Zulu Community builds of OpenJDK &mldr;</p></blockquote><p>Since in our examples we used <code>payara/server-full</code> which is based on <code>azul/zulu-openjdk</code> we&rsquo;re able to leverage that tools. So, let&rsquo;s <a href=https://www.azul.com/products/zulu-mission-control/>download and unpack ZMC (Zulu Mission Control)</a>.</p><p>Just like VisualVM also ZMC had an issue with may ancient Mac-Java - so I had to explicitly point it to a JDK to be used. For that, find the <code>zmc.ini</code>-file (for Mac this is <code>&lt;APP-FOLDER>/Contents/Eclipse/zmc.ini</code>) and add the <code>-vm</code> option:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-vm
/Users/schoeffm/.sdkman/candidates/java/14.0.1-zulu/bin</code></pre></div><p>After that, start the tool, connect it via JMX to the running, containerized process and have look around</p><figure><img src=/posts/troubleshooting-containerized-java-applications/zmc.png alt="Zulu Mission Control" width=100%></figure><p>For Zulu-JDK you don&rsquo;t even have to set <code>-XX:+FlightRecorder</code> anymore to activate the feature since it&rsquo;s activated by default already. But when working with an application server there are still some JVM-options worth changing/setting to get better results.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-XX:FlightRecorderOptions<span style=color:#f92672>=</span>stackdepth<span style=color:#f92672>=</span><span style=color:#ae81ff>2048</span>
-XX:+UnlockDiagnosticVMOptions
-XX:+DebugNonSafepoints</code></pre></div><p><code>FlightRecorderOptions</code> increases the stackdepth that gets recorded (otherwise stack traces would be truncated) and <code>DebugNonSafepoints</code> (which has to be combined with <code>UnlockDiagnosticVMOptions</code>) improves fidelity as explained <a href=https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/about.htm#JFRRT111>here</a>.</p><p>You could even start a continous recording that will be started along with the process and that stores its information in a ring-buffer waiting happily for being dumped and analyzed on demand by adding:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-XX:StartFlightRecording<span style=color:#f92672>=</span>disk<span style=color:#f92672>=</span>true,name<span style=color:#f92672>=</span>core,dumponexit<span style=color:#f92672>=</span>true,maxage<span style=color:#f92672>=</span>3h,settings<span style=color:#f92672>=</span>profile </code></pre></div><p>To get more information about ZMC and its background have a look at <a href=https://www.azul.com/presentation/azul-webinar-open-source-flight-recorder-and-mission-control-managing-and-measuring-openjdk-8-performance/>this webinar recording</a>.</p><p>Happy troubleshooting!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://schoeffm.github.io/tags/java>java</a></li><li><a href=https://schoeffm.github.io/tags/jmx>jmx</a></li><li><a href=https://schoeffm.github.io/tags/flightrecorder>flightrecorder</a></li><li><a href=https://schoeffm.github.io/tags/missioncontrol>missioncontrol</a></li><li><a href=https://schoeffm.github.io/tags/zmc>zmc</a></li><li><a href=https://schoeffm.github.io/tags/visualvm>visualvm</a></li><li><a href=https://schoeffm.github.io/tags/docker>docker</a></li><li><a href=https://schoeffm.github.io/tags/payara>payara</a></li><li><a href=https://schoeffm.github.io/tags/performance>performance</a></li><li><a href=https://schoeffm.github.io/tags/analysis>analysis</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Troubleshooting Containerized Java Applications via JMX on twitter" href="https://twitter.com/intent/tweet/?text=Troubleshooting%20Containerized%20Java%20Applications%20via%20JMX&url=https%3a%2f%2fschoeffm.github.io%2fposts%2ftroubleshooting-containerized-java-applications%2f&hashtags=java%2cjmx%2cflightrecorder%2cmissioncontrol%2czmc%2cvisualvm%2cdocker%2cpayara%2cperformance%2canalysis"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Troubleshooting Containerized Java Applications via JMX on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fschoeffm.github.io%2fposts%2ftroubleshooting-containerized-java-applications%2f&title=Troubleshooting%20Containerized%20Java%20Applications%20via%20JMX&summary=Troubleshooting%20Containerized%20Java%20Applications%20via%20JMX&source=https%3a%2f%2fschoeffm.github.io%2fposts%2ftroubleshooting-containerized-java-applications%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Troubleshooting Containerized Java Applications via JMX on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fschoeffm.github.io%2fposts%2ftroubleshooting-containerized-java-applications%2f&title=Troubleshooting%20Containerized%20Java%20Applications%20via%20JMX"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Troubleshooting Containerized Java Applications via JMX on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fschoeffm.github.io%2fposts%2ftroubleshooting-containerized-java-applications%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Troubleshooting Containerized Java Applications via JMX on whatsapp" href="https://api.whatsapp.com/send?text=Troubleshooting%20Containerized%20Java%20Applications%20via%20JMX%20-%20https%3a%2f%2fschoeffm.github.io%2fposts%2ftroubleshooting-containerized-java-applications%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23-13.314-11.876-22.304-26.542-24.916-31.026s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Troubleshooting Containerized Java Applications via JMX on telegram" href="https://telegram.me/share/url?text=Troubleshooting%20Containerized%20Java%20Applications%20via%20JMX&url=https%3a%2f%2fschoeffm.github.io%2fposts%2ftroubleshooting-containerized-java-applications%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47A3.38 3.38.0 0126.49 29.86zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2020 <a href=https://schoeffm.github.io/>Personal PasteBin</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo️️</a>️</span>
<span>&#183;</span>
<span>Theme️ <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top"><button class=top-link id=top-link type=button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script src=https://schoeffm.github.io/assets/js/highlight.min.e7afc2928c0925d65c4732dfebe147014d91299a98e819e4b42f25c4fa68e91c.js integrity="sha256-56/CkowJJdZcRzLf6+FHAU2RKZqY6BnktC8lxPpo6Rw="></script><script>hljs.initHighlightingOnLoad();</script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth"});});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>